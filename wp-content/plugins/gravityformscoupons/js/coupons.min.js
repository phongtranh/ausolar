function ApplyCouponCode(a){var b=jQuery("#gf_coupon_code_"+a).val();"undefined"!==b&&""!=b&&(jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0),jQuery.post(gform_coupon_script_strings.ajaxurl,{action:"gf_apply_coupon_code",couponCode:b,existing_coupons:jQuery("#gf_coupon_codes_"+a).val(),formId:a,total:jQuery("#gf_total_no_discount_"+a).val()},function(b){var c=jQuery.parseJSON(b);if(jQuery("#gf_coupons_container_"+a+" .gf_coupon_invalid").remove(),jQuery("#gf_coupon_code_"+a).val(""),c.is_valid){window["gf_coupons"+a]=c.coupons;var d="",e=0;for(coupon in window["gf_coupons"+a])e>0&&(d+=","),d+=window["gf_coupons"+a][coupon].code,e++;jQuery("#gf_coupon_codes_"+a).val(d).change(),jQuery("#gf_coupons_"+a).val(jQuery.toJSON(window["gf_coupons"+a])),gformCalculateTotalPrice(a)}else jQuery("#gf_coupons_container_"+a+" #gf_coupon_info").prepend("<div class='gf_coupon_invalid'><span>"+c.invalid_reason+"</span></div>");jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").hide()}))}function GetDiscount(a,b,c,d){return c-=d,discount="flat"==a?Number(b):c*Number(b/100),discount=gform.applyFilters("gform_coupons_discount_amount",discount,a,b,c,d),discount}function PopulateDiscountInfo(a,b){var c="",d=0,e=new Currency(gf_global.gf_currency_config);void 0===window["gf_coupons"+b]&&(window["gf_coupons"+b]=jQuery.evalJSON(jQuery("#gf_coupons_"+b).val()));for(code in window["gf_coupons"+b])coupon=window["gf_coupons"+b][code],couponDiscount=GetDiscount(coupon.type,coupon.amount,a,d),d+=couponDiscount,c+='<tr class="gf_coupon_item" id="gf_coupon_'+coupon.code+'"><td class="gf_coupon_name_container">   <a href="javascript:void(0);" onclick="DeleteCoupon(\''+coupon.code+"' , '"+b+'\');">(x)</a>   <span class="gf_coupon_name">'+coupon.name+'</span></td><td class="gf_coupon_discount_container">   <span class="gf_coupon_discount">-'+e.toMoney(couponDiscount)+"</span></td></tr>";return jQuery("#gf_coupons_container_"+b+" #gf_coupon_info").html("<table>"+c+"</table>"),d}function DisableApplyButton(a){var b=0==window["new_total_"+a]||""==jQuery("#gf_coupons_container_"+a+" #gf_coupon_code_"+a).val();b?jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0):jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!1)}function gform_product_total(a,b){if(0==jQuery("#gf_coupon_code_"+a).length)return b;jQuery("#gf_total_no_discount_"+a).val(b);var c=gformIsHidden(jQuery("#gf_coupon_code_"+a))?"":jQuery("#gf_coupon_codes_"+a).val(),d=""!=c||""!=jQuery("#gf_coupons_"+a).val();if(window["new_total_"+a]=b,new_total=window["new_total_"+a],d){var e=0;e=PopulateDiscountInfo(b,a),new_total=b-e}return jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").hide(),DisableApplyButton(a),new_total}function DeleteCoupon(a,b){if(!jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").is(":visible")){jQuery("#gf_coupons_container_"+b+" #gf_coupon_"+a).remove(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_button").prop("disabled",!0);var c=jQuery("#gf_coupon_codes_"+b).val().split(","),d=jQuery.inArray(a,c);if(-1!=d){c.splice(d,1),jQuery("#gf_coupon_codes_"+b).val(c.join(",")).change();var e,f=new Array;for(e in window["gf_coupons"+b])window["gf_coupons"+b][e].code!=a&&(f[e]=window["gf_coupons"+b][e]);window["gf_coupons"+b]=f,gformCalculateTotalPrice(b)}}}gform.addFilter("gform_is_value_match",function(a,b,c){var d=jQuery("#field_"+b+"_"+c.fieldId).find("#gf_coupon_codes_"+b);return d.length?gf_matches_operation(d.val(),c.value,c.operator):a}),gform.addAction("gform_post_conditional_logic_field_action",function(a,b,c,d,e){if(!e&&"hide"==b){var f=jQuery(c),g=f.find("tr.gf_coupon_item");g.length&&(g.remove(),f.find("input[type=hidden]").val("").change())}});