var SlBooking=SlBooking||{};SlBooking.validate=function(a){"use strict";function b(b,c){var d,e=a(b),f=e.closest(".error-box");return e.html(""),d=c(e),f[d?"addClass":"removeClass"]("hidden"),d}function c(b){var c=a(".passenger:first"),d=!0,e=!0;c.find(".name").each(function(){a(this).val()||(e=!1)}),e||(b.append("<p>"+k.name+"</p>"),d=!1);var f=c.find(".email").val();return f?f&&!rw_utils.is_email(f)&&(b.append("<p>"+k.invalidEmail+"</p>"),d=!1):(b.append("<p>"+k.email+"</p>"),d=!1),d}function d(){var b=a(".passenger:first"),c=b.find(".email").val();return b.find(".name.first").val()&&b.find(".name.last").val()&&c&&rw_utils.is_email(c)}function e(b){var c=a("[name=agree]");return c.length&&!c.is(":checked")?(b.html("<p>"+k.term+"</p>"),!1):!0}function f(){var b=a("[name=agree]");return!b.length||b.is(":checked")}function g(b){var c=!0;return a(".payment").length?(a("[name=card_holders_name]").val()||(b.append("<p>"+k.carName+"</p>"),c=!1),a("[name=card_number]").val()||(b.append("<p>"+k.cardNumber+"</p>"),c=!1),a("[name=card_expiry_month]").val()||(b.append("<p>"+k.cardExpiryMonth+"</p>"),c=!1),a("[name=card_expiry_year]").val()||(b.append("<p>"+k.cardExpiryYear+"</p>"),c=!1),a("[name=card_cvn]").val()||(b.append("<p>"+k.cardCvn+"</p>"),c=!1),c):c}function h(){return a(".payment").length?a("[name=card_holders_name]").val()&&a("[name=card_number]").val()&&a("[name=card_expiry_month]").val()&&a("[name=card_expiry_year]").val()&&a("[name=card_cvn]").val():!0}function i(b){var c=a("input[name=payment_gateway]");return c.length&&!c.filter(":checked").length?(b.html("<p>"+k.payment+"</p>"),!1):!0}function j(){var b=a("input[name=payment_gateway]");return!b.length||b.filter(":checked").length}var k=Sl.bookingErrors;return{passenger:function(){return b(".error-passenger",c)},term:function(){return b(".error-terms",e)},creditCard:function(){return b(".error-cc",g)},paymentGateway:function(){return b(".error-gateways",i)},validToCheckout:function(){return d()&&f()},validCreditCart:h,validToPay:function(){return d()&&f()&&j()&&h()}}}(jQuery);var SlBooking=SlBooking||{};SlBooking=$.extend(SlBooking,function(a){"use strict";var b=new MobileDetect(window.navigator.userAgent);return{toggleResources:function(){a("body").on("click",function(b){var c=a(".change-resource").siblings("ul");a(b.target).is(".change-resource")?(b.preventDefault(),c.toggleClass("hidden")):c.addClass("hidden")})},toggleMoreGuests:function(){a(".more-guests").on("click","a",function(b){b.preventDefault(),a(this).addClass("hidden").siblings().removeClass("hidden"),a(".other-passengers").toggleClass("hidden")})},addCreditCardIcon:function(){a("[name=card_number]").keyup(function(){var b=a(this),c=b.siblings(".icon"),d=rw_utils.get_cc_type(b.val());c.removeClass("visa mastercard amex"),"unknown"!=d&&c.addClass(d)})},agree:function(){a(".modal-footer .agree").on("click",function(b){b.preventDefault(),a("[name=agree]").prop("checked",!0).trigger("change")})},togglePayButton:function(){var b=a(".contact"),c=a(".payment"),d=a(".pay").closest(".sl-field");c.length?(b.on("change","input",function(){var a=b.find(".next").closest(".sl-field");a[SlBooking.validate.validToCheckout()?"removeClass":"addClass"]("hidden")}),c.on("change","input",function(){d[SlBooking.validate.validCreditCart()?"removeClass":"addClass"]("hidden")})):b.on("change","input",function(){d[SlBooking.validate.validToPay()?"removeClass":"addClass"]("hidden")})},formatCurrency:function(a,b){var c;return a=parseFloat(a),isNaN(a)&&(a=0),"undefined"==typeof b&&(b=!0),b&&(a=a.toFixed(2)),"left"==Sl.currencyPosition?c=Sl.currency+a:"right"==Sl.currencyPosition?c=a+Sl.currency:"left_space"==Sl.currencyPosition?c=Sl.currency+" "+a:"right_space"==Sl.currencyPosition&&(c=a+" "+Sl.currency),c},mobileClass:function(){var c=b.phone()?"phone":b.tablet()?"tablet":"";c&&(a("body").addClass(c+"-device"),a('[name="device"]').val(c))},addMoreGuests:function(b,c){a(".passenger:gt("+(b-1)+")").remove();for(var d,e=a(".other-passengers"),f=a(".passenger:first"),g=a(".passenger").length;b>g;g++)d=f.clone(),d.appendTo(e).prepend('<h4 class="guest-title">'+Sl[c].guestTitle+" "+(g+1)+"</h4>").find("input").val("").end().find(".required").removeClass("required").end().find(".more-guests").remove().end().find(".sl-input-warning").remove().end().find(".name").unwrap();e.addClass("hidden"),a(".guests-hide").addClass("hidden"),a(".guests-show")[2>b?"addClass":"removeClass"]("hidden");var h=400;e.find("[tabindex]").each(function(){a(this).attr("tabindex",++h)})},setDatetimePickerDefaults:function(){a.datepicker.setDefaults({dateFormat:"d/m/yy",numberOfMonths:b.phone()?1:b.tablet()?2:3})},beforeDatetimePickerShow:function(){a(this).prop("disabled",!0);var c="sl-datepicker sl-button";b.phone()?c+=" phone":b.tablet()&&(c+=" tablet"),a.fn.datetimepicker&&(c+=" sl-timepicker-slider"),a("#ui-datepicker-div").addClass(c)},afterDatetimePickerShow:function(){a(this).prop("disabled",!1)},checkFreeBooking:function(b){var c=a(".payment-gateway"),d=a(".button.pay");b?(c.removeClass("hidden"),d.val(Sl.bookingText)):(c.addClass("hidden").find("input:first").prop("checked",!0),d.val(Sl.bookingTextFree))}}}(jQuery)),SlBooking.panel=function(a){"use strict";return{showActive:function(){a(".panel.active .panel-content").addClass("show")},next:function(){a(".next").click(function(b){b.preventDefault();var c=a(this).closest(".panel"),d=c.next();(!c.hasClass("contact")||SlBooking.validate.passenger()&&SlBooking.validate.term()&&SlBooking.validate.paymentGateway())&&(c.removeClass("active").addClass("collapse").find(".panel-content").removeClass("show"),d.addClass("active").removeClass("collapse").find(".panel-content").addClass("show"))})},expand:function(){a(".booking-form").on("click",".collapse > h2",function(b){b.preventDefault();var c=a(this).closest(".panel");a(".panel").each(function(){var b=a(this);b.find("nav").hasClass("hidden")||(b.addClass("collapse"),b.next().addClass("collapse")),b.filter(".active").removeClass("active").find(".panel-content").removeClass("show")}),c.addClass("active").removeClass("collapse").find(".panel-content").addClass("show")})}}}(jQuery),jQuery(function(){"use strict";SlBooking.panel.showActive(),SlBooking.panel.expand(),SlBooking.panel.next(),SlBooking.mobileClass(),SlBooking.setDatetimePickerDefaults(),SlBooking.toggleResources(),SlBooking.toggleMoreGuests(),SlBooking.togglePayButton(),SlBooking.addCreditCardIcon(),SlBooking.agree()}),jQuery(function(a){"use strict";function b(){a(".datepicker").each(function(){var b=a(this),c=s.find(".depart");b.datepicker({dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],beforeShowDay:function(c){var d,e=new Date,f=rw_date.obj_to_euro(c),g=b.data("days"),h=c.getDay();return e.setHours(0,0,0,0),d=c>=e&&Resource.allocation>0,d=d&&a.inArray(f,Resource.unbookable)<0,g&&(d=d&&-1!=g.toString().indexOf(h)),[d,""]},onSelect:function(b){d(b),c.removeClass("hidden").find(".day").text(b),a.post(Sl.ajaxUrl,{action:"sl_tour_get_scheduled_price",resource:Resource.title,post_id:Resource.post_id,date:b},function(b){b.success?a.extend(!0,Resource,b.data):alert(b.data),o(),v.val(-1)},"json"),a.post(Sl.ajaxUrl,{action:"sl_tour_get_allocation",resource:Resource.title,post_id:Resource.post_id,date:b},function(b){Resource.allocation=parseInt(b.data.allocation),t.find(".sl-input").html(b.data.html),a(".passenger-type select").trigger("change"),m()},"json")},beforeShow:SlBooking.beforeDatetimePickerShow,onClose:SlBooking.afterDatetimePickerShow})})}function c(){var a=r.find(".specific-day-depart"),b=a.length>=2||1==a.length&&a.children().length<3||w.length&&w.children().length<3;r[b?"addClass":"removeClass"]("hidden")}function d(b){var c;if(w.length>0)return void(w.children().length>2?r.removeClass("hidden"):(c=w.children(":last").val(),w.val(c).trigger("change")));var d=rw_date.get_obj(b).getDay(),e=a('[data-day="'+d+'"]');e.length>0&&(e.children().length>2?(a(".specific-day-depart").addClass("hidden"),e.removeClass("hidden"),r.removeClass("hidden")):(c=e.children(":last").val(),e.val(c).trigger("change")))}function e(){r.on("change",".time-select",function(){var b=a(this),c=b.val()?b.children(":selected").text():"";f(c)}),r.on("change",".time-input",function(){var b=a("#hour-input").val(),c=a("#minute-input").val(),d=b&&c?b+":"+c:"";a('[name="custom_depart"]').val(d),f(d)})}function f(a){a&&s.find(".depart").removeClass("hidden").find(".time").text(a),m(),p()}function g(){t.on("change",".passenger-type select",function(){var b,c,d=a(this),e=d.attr("name"),f=d.val(),g=s.find(".passengers"),h=s.find("."+e),i=h.find(".left"),j=h.find(".right"),k=!1,m=0,o=a(".passenger-type select");if(-1==f)i.text("0 "+e),j.text(SlBooking.formatCurrency(0)),h.addClass("hidden"),o.each(function(){-1!=a(this).val()&&(k=!0)}),k||g.addClass("hidden");else{switch(i.text(f+" "+e),h.removeClass("hidden"),b="adult",e){case"children":b="child";break;case"seniors":b="senior";break;case"families":b="family";break;case"infants":b="infant"}b="price_"+b,c=Resource[b]?parseFloat(Resource[b]):0,j.text(SlBooking.formatCurrency(f*c)),g.removeClass("hidden")}if(o.each(function(){-1!=a(this).val()&&(m+=parseInt(a(this).val()))}),SlBooking.addMoreGuests(m,"tour"),l()>Resource.allocation){var r=Sl.tour.exceedAllocation.replace("%d",Resource.allocation);t.find(".error.exceed-allocation").length?t.find(".error.exceed-allocation").html(r).removeClass("hidden"):t.find(".sl-input").append('<div class="error exceed-allocation">'+r+"</div>")}else t.find(".error.exceed-allocation").addClass("hidden");v.trigger("change"),q(),n(),p()})}function h(){v.change(function(){var b=a(this),c=b.attr("name"),d=c.split("_")[1],e=b.val(),f=s.find("."+c),g=f.find(".left"),h=f.find(".right"),i=!1,j=s.find(".options"),k=Resource.upsell_prices[d]?parseFloat(Resource.upsell_prices[d]):0,l=0;-1==e?(h.text(SlBooking.formatCurrency(0)),g.text(Resource.upsell_items[d]),f.addClass("hidden"),v.each(function(){-1!=a(this).val()&&(i=!0)}),i||j.addClass("hidden")):(Resource.upsell_multipliers&&Resource.upsell_multipliers[d]&&(a(".guests select").each(function(){var b=parseInt(a(this).val());-1!=b&&(l+=b)}),k*=l),h.text(SlBooking.formatCurrency(e*k)),g.text(e+" x "+Resource.upsell_items[d]),f.removeClass("hidden"),j.removeClass("hidden")),q()})}function i(){a(".booking-form").submit(function(b){b.preventDefault();var c,d=SlBooking.validate;c=d.passenger(),c=d.term()&&c,c=d.paymentGateway()&&c,c=d.creditCard()&&c,c&&a.post(Sl.ajaxUrl,{action:"sl_tour_add_booking",_wpnonce:Resource.nonceAddBooking,post_id:Resource.post_id,resource:Resource.title,data:a(".booking-form").serialize()},function(b){return/^http/.test(b)?void(location.href=b):-1===b.indexOf("checkout_form")?void alert(b):(a(b).appendTo("body"),a("#checkout_form").modal(),void setTimeout(function(){a("#checkout_form").submit()},2e3))})})}function j(){var b=a('[name="day"]'),c=b.val();if(b.length&&!c)return!1;var d=a(".departure.time"),e=!0;if(d.find("[data-day]").length){c=rw_date.get_obj(c);var f=c.getDay(),g=a('[data-day="'+f+'"]');g.length&&!g.val()&&(e=!1)}else d.find(":input[name]").each(function(){a(this).val()||(e=!1)});return e}function k(){var b=!1;return a(".passenger-type select").each(function(){-1!=a(this).val()&&(b=!0)}),b}function l(){var b=0;return a(".passenger-type select").each(function(){var c=a(this),d=c.val(),e=c.attr("name");-1!=d&&(b+=d*("families"==e?4:1))}),b}function m(){t[j()?"removeClass":"addClass"]("hidden"),n()}function n(){k()&&!t.hasClass("hidden")?u.removeClass("hidden"):(u.addClass("hidden"),v.val(-1))}function o(){for(var b=Resource.upsell_prices.length;b--;)a("[name=upsell_"+b+"]").parent().find(".amount").text(Resource.upsell_prices[b])}function p(){var b=a("#to-contact");b.trigger("sl-next-toggle");var c=k()&&l()<=Resource.allocation&&j()&&!b.data("hide");b.closest(".sl-field")[c?"removeClass":"addClass"]("hidden")}function q(){for(var b,c,d,e=0,f=0,g=0,h=["adult","child","senior","family","infant"],i=h.length;i--;)c=a("#guest-"+h[i]),c.length&&(b=parseInt(c.val()),d=Resource["price_"+h[i]]?parseFloat(Resource["price_"+h[i]]):0,-1!=b&&d&&(e+=b*d,g+=b));v.each(function(){var b,c=a(this),d=c.attr("name").split("_")[1],e=c.val();-1!=e&&Resource.upsell_prices[d]&&(b=parseFloat(Resource.upsell_prices[d]),Resource.upsell_multipliers[d]&&(b*=g),f+=e*b)});var j=e+f;a("[name=amount]").val(j),a("[name=verify]").val(3*j-10+","+Resource.nonceAddBooking),a(".total_guests").removeClass("hidden").find(".right").text(SlBooking.formatCurrency(e)),a(".total_upsells").removeClass("hidden").find(".right").text(SlBooking.formatCurrency(f)),a(".total .right").text(SlBooking.formatCurrency(j)),SlBooking.checkFreeBooking(j)}var r=a(".departure.time"),s=a(".summary"),t=a(".guests"),u=a(".upsells"),v=u.find("select"),w=a("#daily-depart");b(),c(),e(),g(),h(),i()});