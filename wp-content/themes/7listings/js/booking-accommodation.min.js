var SlBooking=SlBooking||{};SlBooking.validate=function(a){"use strict";function b(b,c){var d,e=a(b),f=e.closest(".error-box");return e.html(""),d=c(e),f[d?"addClass":"removeClass"]("hidden"),d}function c(b){var c=a(".passenger:first"),d=!0,e=!0;c.find(".name").each(function(){a(this).val()||(e=!1)}),e||(b.append("<p>"+k.name+"</p>"),d=!1);var f=c.find(".email").val();return f?f&&!rw_utils.is_email(f)&&(b.append("<p>"+k.invalidEmail+"</p>"),d=!1):(b.append("<p>"+k.email+"</p>"),d=!1),d}function d(){var b=a(".passenger:first"),c=b.find(".email").val();return b.find(".name.first").val()&&b.find(".name.last").val()&&c&&rw_utils.is_email(c)}function e(b){var c=a("[name=agree]");return c.length&&!c.is(":checked")?(b.html("<p>"+k.term+"</p>"),!1):!0}function f(){var b=a("[name=agree]");return!b.length||b.is(":checked")}function g(b){var c=!0;return a(".payment").length?(a("[name=card_holders_name]").val()||(b.append("<p>"+k.carName+"</p>"),c=!1),a("[name=card_number]").val()||(b.append("<p>"+k.cardNumber+"</p>"),c=!1),a("[name=card_expiry_month]").val()||(b.append("<p>"+k.cardExpiryMonth+"</p>"),c=!1),a("[name=card_expiry_year]").val()||(b.append("<p>"+k.cardExpiryYear+"</p>"),c=!1),a("[name=card_cvn]").val()||(b.append("<p>"+k.cardCvn+"</p>"),c=!1),c):c}function h(){return a(".payment").length?a("[name=card_holders_name]").val()&&a("[name=card_number]").val()&&a("[name=card_expiry_month]").val()&&a("[name=card_expiry_year]").val()&&a("[name=card_cvn]").val():!0}function i(b){var c=a("input[name=payment_gateway]");return c.length&&!c.filter(":checked").length?(b.html("<p>"+k.payment+"</p>"),!1):!0}function j(){var b=a("input[name=payment_gateway]");return!b.length||b.filter(":checked").length}var k=Sl.bookingErrors;return{passenger:function(){return b(".error-passenger",c)},term:function(){return b(".error-terms",e)},creditCard:function(){return b(".error-cc",g)},paymentGateway:function(){return b(".error-gateways",i)},validToCheckout:function(){return d()&&f()},validCreditCart:h,validToPay:function(){return d()&&f()&&j()&&h()}}}(jQuery);var SlBooking=SlBooking||{};SlBooking=$.extend(SlBooking,function(a){"use strict";var b=new MobileDetect(window.navigator.userAgent);return{toggleResources:function(){a("body").on("click",function(b){var c=a(".change-resource").siblings("ul");a(b.target).is(".change-resource")?(b.preventDefault(),c.toggleClass("hidden")):c.addClass("hidden")})},toggleMoreGuests:function(){a(".more-guests").on("click","a",function(b){b.preventDefault(),a(this).addClass("hidden").siblings().removeClass("hidden"),a(".other-passengers").toggleClass("hidden")})},addCreditCardIcon:function(){a("[name=card_number]").keyup(function(){var b=a(this),c=b.siblings(".icon"),d=rw_utils.get_cc_type(b.val());c.removeClass("visa mastercard amex"),"unknown"!=d&&c.addClass(d)})},agree:function(){a(".modal-footer .agree").on("click",function(b){b.preventDefault(),a("[name=agree]").prop("checked",!0).trigger("change")})},togglePayButton:function(){var b=a(".contact"),c=a(".payment"),d=a(".pay").closest(".sl-field");c.length?(b.on("change","input",function(){var a=b.find(".next").closest(".sl-field");a[SlBooking.validate.validToCheckout()?"removeClass":"addClass"]("hidden")}),c.on("change","input",function(){d[SlBooking.validate.validCreditCart()?"removeClass":"addClass"]("hidden")})):b.on("change","input",function(){d[SlBooking.validate.validToPay()?"removeClass":"addClass"]("hidden")})},formatCurrency:function(a,b){var c;return a=parseFloat(a),isNaN(a)&&(a=0),"undefined"==typeof b&&(b=!0),b&&(a=a.toFixed(2)),"left"==Sl.currencyPosition?c=Sl.currency+a:"right"==Sl.currencyPosition?c=a+Sl.currency:"left_space"==Sl.currencyPosition?c=Sl.currency+" "+a:"right_space"==Sl.currencyPosition&&(c=a+" "+Sl.currency),c},mobileClass:function(){var c=b.phone()?"phone":b.tablet()?"tablet":"";c&&(a("body").addClass(c+"-device"),a('[name="device"]').val(c))},addMoreGuests:function(b,c){a(".passenger:gt("+(b-1)+")").remove();for(var d,e=a(".other-passengers"),f=a(".passenger:first"),g=a(".passenger").length;b>g;g++)d=f.clone(),d.appendTo(e).prepend('<h4 class="guest-title">'+Sl[c].guestTitle+" "+(g+1)+"</h4>").find("input").val("").end().find(".required").removeClass("required").end().find(".more-guests").remove().end().find(".sl-input-warning").remove().end().find(".name").unwrap();e.addClass("hidden"),a(".guests-hide").addClass("hidden"),a(".guests-show")[2>b?"addClass":"removeClass"]("hidden");var h=400;e.find("[tabindex]").each(function(){a(this).attr("tabindex",++h)})},setDatetimePickerDefaults:function(){a.datepicker.setDefaults({dateFormat:"d/m/yy",numberOfMonths:b.phone()?1:b.tablet()?2:3})},beforeDatetimePickerShow:function(){a(this).prop("disabled",!0);var c="sl-datepicker sl-button";b.phone()?c+=" phone":b.tablet()&&(c+=" tablet"),a.fn.datetimepicker&&(c+=" sl-timepicker-slider"),a("#ui-datepicker-div").addClass(c)},afterDatetimePickerShow:function(){a(this).prop("disabled",!1)},checkFreeBooking:function(b){var c=a(".payment-gateway"),d=a(".button.pay");b?(c.removeClass("hidden"),d.val(Sl.bookingText)):(c.addClass("hidden").find("input:first").prop("checked",!0),d.val(Sl.bookingTextFree))}}}(jQuery)),SlBooking.panel=function(a){"use strict";return{showActive:function(){a(".panel.active .panel-content").addClass("show")},next:function(){a(".next").click(function(b){b.preventDefault();var c=a(this).closest(".panel"),d=c.next();(!c.hasClass("contact")||SlBooking.validate.passenger()&&SlBooking.validate.term()&&SlBooking.validate.paymentGateway())&&(c.removeClass("active").addClass("collapse").find(".panel-content").removeClass("show"),d.addClass("active").removeClass("collapse").find(".panel-content").addClass("show"))})},expand:function(){a(".booking-form").on("click",".collapse > h2",function(b){b.preventDefault();var c=a(this).closest(".panel");a(".panel").each(function(){var b=a(this);b.find("nav").hasClass("hidden")||(b.addClass("collapse"),b.next().addClass("collapse")),b.filter(".active").removeClass("active").find(".panel-content").removeClass("show")}),c.addClass("active").removeClass("collapse").find(".panel-content").addClass("show")})}}}(jQuery),jQuery(function(){"use strict";SlBooking.panel.showActive(),SlBooking.panel.expand(),SlBooking.panel.next(),SlBooking.mobileClass(),SlBooking.setDatetimePickerDefaults(),SlBooking.toggleResources(),SlBooking.toggleMoreGuests(),SlBooking.togglePayButton(),SlBooking.addCreditCardIcon(),SlBooking.agree()}),jQuery(function(a){"use strict";function b(){j.datepicker({minDate:l,beforeShowDay:function(b){return[a.inArray(rw_date.obj_to_euro(b),Resource.unbookable)<0,""]},onSelect:function(b){i.find(".checkin-time").removeClass("hidden").find(".right").text(b),k.prop("disabled",!0),a.post(Sl.ajaxUrl,{action:"sl_accommodation_get_max_date",post_id:Resource.post_id,resource:Resource.title,date:b},function(a){k.prop("disabled",!1).datepicker("option","minDate",rw_date.get_obj(b)),a&&k.datepicker("option","maxDate",a)}),g(),f()},beforeShow:SlBooking.beforeDatetimePickerShow,onClose:SlBooking.afterDatetimePickerShow})}function c(){k.datepicker({minDate:l,beforeShowDay:function(b){return[a.inArray(rw_date.obj_to_euro(b),Resource.unbookable)<0,""]},onSelect:function(a){i.find(".checkout-time").removeClass("hidden").find(".right").text(a),g(),f()},beforeShow:SlBooking.beforeDatetimePickerShow,onClose:SlBooking.afterDatetimePickerShow})}function d(){m.change(function(){var b=a(this),c=b.val(),d=i.find(".guests"),e=i.find(".extra-guests");if(-1==c)d.addClass("hidden"),e.addClass("hidden");else if(d.removeClass("hidden"),c<=Resource.occupancy)e.addClass("hidden"),d.find(".left").text(c+" "+h.guests);else{e.removeClass("hidden");var j=c-Resource.occupancy;d.find(".left").text(Resource.occupancy+" "+h.guests),e.find(".left").text("+ "+j+" x "+h.extra)}SlBooking.addMoreGuests(c,"accommodation"),g(),f()})}function e(){a(".booking-form").submit(function(b){b.preventDefault();var c,d=SlBooking.validate;return c=d.passenger(),c=d.term()&&c,c=d.paymentGateway()&&c,(c=d.creditCard()&&c)?(a.post(Sl.ajaxUrl,{action:"sl_accommodation_add_booking",_wpnonce:Resource.nonceAddBooking,post_id:Resource.post_id,resource:Resource.title,data:a(this).serialize()},function(b){return/^http/.test(b)?void(location.href=b):-1===b.indexOf("checkout_form")?void alert(b):(a(b).appendTo("body"),a("#checkout_form").modal(),void setTimeout(function(){a("#checkout_form").submit()},2e3))}),!1):void 0})}function f(){var b=a("#to-contact"),c=-1!=m.val()&&j.val()&&k.val();b.closest(".sl-field")[c?"removeClass":"addClass"]("hidden")}function g(){var b,c,d,e=j.val(),f=k.val();if(e&&f){if(e=rw_date.toUSA(e),f=rw_date.toUSA(f),c=rw_date.days_diff(e,f),0===c&&(c=1),0>c)return void alert(h.invalidDates);a(".nights").removeClass("hidden").find(".right").text(c),a(".panel .rate").addClass("hidden"),a("input[name=amount]").val(""),a(".total .right").text(SlBooking.formatCurrency(0)),a.post(Sl.ajaxUrl,{action:"sl_accommodation_get_total_price",resource:Resource.title,post_id:Resource.post_id,from:e,to:f},function(e){var f,g=parseFloat(e.total),h=e.prices,j=i.find(".guests"),k=[];m.length&&(b=m.val(),-1!=b&&b>Resource.occupancy&&(d=Resource.price_extra*(b-Resource.occupancy),g+=parseFloat(d)*c)),a("[name=amount]").val(g),a("[name=verify]").val(3*g-10+","+Resource.nonceAddBooking),a(".total .right").text(SlBooking.formatCurrency(g)),f=g/c,a(".panel .rate").removeClass("hidden"),a(".panel .rate strong").text(parseFloat(f.toFixed(2)));for(var l in h)h.hasOwnProperty(l)&&k.push(SlBooking.formatCurrency(l)+" x "+h[l]);j.find(".right").html(k.join("<br>")),-1!=b&&b>Resource.occupancy&&i.find(".extra-guests .right").html(SlBooking.formatCurrency(d)+" x "+c),SlBooking.checkFreeBooking(g)},"json")}}var h=Sl.accommodation,i=a(".summary"),j=a("#checkin"),k=a("#checkout"),l=new Date,m=a("#guests");l.setHours(0,0,0,0),Resource.occupancy=parseInt(Resource.occupancy),Resource.price=parseFloat(Resource.price),Resource.price_extra=parseFloat(Resource.price_extra),Resource.unbookable=Resource.unbookable||[],b(),c(),d(),e()});